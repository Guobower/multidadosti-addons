<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_multi_calendar_event_tree" model="ir.ui.view">
        <field name="name">calendar.event.tree</field>
        <field name="model">calendar.event</field>
        <field name="inherit_id" ref="calendar.view_calendar_event_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_ids']" position="after">
                <field name="project_id"/>
                <field name="task_id"/>
                <field name="meeting_state"/>
                <field name="state" invisible="1"/>
            </xpath>
        </field>
    </record>

    <record id="view_multi_calendar_event_form" model="ir.ui.view">
        <field name="name">multi.calendar.event</field>
        <field name="model">calendar.event</field>
        <field name="inherit_id" ref="calendar.view_calendar_event_form"/>
        <field name="arch" type="xml">
            <xpath expr="//label[@for='partner_ids']" position="before">
                <label for="partner_id" string="Partner" class="oe_edit_only"/>
                <h2>
                    <field name="company_partner_id" invisible="1"/>
                    <field name="partner_id" placeholder="Select partner..." nolabel="1" class="oe_inline" domain="[('parent_id', '=', False)]"/>
                </h2>
            </xpath>

            <xpath expr="//sheet" position="before">
                <header>
                    <button name="done_button" string='Done' type="object"
                            class="btn-primary"
                            attrs="{'invisible': [('meeting_state','in',['done', 'cancel'])]}"/>
                    <button name="cancel_button" string='Cancel' type="object"
                            attrs="{'invisible': [('meeting_state','in',['done', 'cancel'])]}"/>
                    <button name="open_button" string='Open' type="object"
                            attrs="{'invisible': [('meeting_state','in',['open', 'done'])]}"/>
                    <field name="meeting_state" widget="statusbar"/>
                </header>
            </xpath>

            <xpath expr="//field[@name='partner_ids']" position="attributes">
                <attribute name="domain">
                    ['|',('parent_id','=',partner_id),('parent_id','=',company_partner_id)]
                </attribute>
            </xpath>

            <xpath expr="//notebook" position="inside">
                <page string="After Meeting" attrs="{'invisible': [('meeting_state','!=','done')]}">
                    <group>
                        <field name="meeting_feedback"/>
                        <field name="meeting_duration"/>
                    </group>
                </page>
                <page string="Project">
                    <group>
                        <field name="project_id"
                               domain="[('partner_ids', '=', partner_id)]"/>
                        <field name="task_id"
                               domain="[('project_id', '=', project_id)]"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Inherit Form View to Modify it -->
    <record id="view_calendar_event_form_popup" model="ir.ui.view">
        <field name="name">calendar.event.form.popup</field>
        <field name="model">calendar.event</field>
        <field name="inherit_id" ref="calendar.view_calendar_event_form_popup"/>
        <field name="arch" type="xml">

            <xpath expr="//field[@name='partner_ids']" position="before">
                <field name="partner_id"/>
                <field name="meeting_state"/>
            </xpath>

            <xpath expr="//field[@name='location']" position="before">
                <field name="project_id"/>
                <field name="task_id"/>
            </xpath>

            <xpath expr="//form" position="inside">
                <!-- Add your fields or attributes here -->
                <notebook attrs="{'invisible': [('description','=', False),('meeting_state','!=','done')]}">

                    <page string="Description" attrs="{'invisible': [('description','=', False)]}">
                        <field name="description" style="margin: 10px 0px 10px 0px;"/>
                    </page>

                    <page string="After Meeting" attrs="{'invisible': [('meeting_state','!=','done')]}">
                        <group>
                            <field name="meeting_feedback"/>
                            <field name="meeting_duration"/>
                        </group>
                    </page>

                </notebook>
            </xpath>

        </field>
    </record>

    <record id="view_multi_calendar_event_calendar" model="ir.ui.view">
        <field name="name">calendar.event.calendar</field>
        <field name="model">calendar.event</field>
        <field name="inherit_id" ref="calendar.view_calendar_event_calendar"/>
        <field name="arch" type="xml">
            <xpath expr="//calendar" position="attributes">
                <attribute name="quick_add">False</attribute>
            </xpath>
        </field>
    </record>

    <record id="view_multi_calendar_event_search" model="ir.ui.view">
        <field name="name">multi.calendar.event.search</field>
        <field name="model">calendar.event</field>
        <field name="inherit_id" ref="calendar.view_calendar_event_search"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='categ_ids']" position="after">
                <field name="project_id"/>
                <field name="task_id"/>
            </xpath>
        </field>
    </record>

    <record id="act_calendar_event_meetings_line_by_project" model="ir.actions.act_window">
        <field name="name">Activities</field>
        <field name="res_model">calendar.event</field>
        <field name="view_type">form</field>
        <field name="view_mode">calendar,form</field>
        <field name="view_id" ref="calendar.view_calendar_event_calendar"/>
        <field name="domain">[('project_id', '!=', False)]</field>
        <field name="context">{"default_project_id": active_id, "search_default_project_id": [active_id]}
        </field>
        <field name="search_view_id"
               ref="calendar.view_calendar_event_search"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to record activities.
            </p>
            <p>
                You can register and track your calendar events by project
                every
                day.
            </p>
        </field>
    </record>

</odoo>